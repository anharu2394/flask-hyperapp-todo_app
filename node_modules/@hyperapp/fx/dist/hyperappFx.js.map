{"version":3,"sources":["dist/hyperappFx.js"],"names":["global","factory","exports","module","define","amd","hyperappFx","this","assign","source","assignments","i","result","ACTION","FRAME","DELAY","TIME","LOG","HTTP","EVENT","KEY_DOWN","KEY_UP","RANDOM","DEBOUNCE","THROTTLE","makeDefaultFx","fx","props","getAction","name","data","requestAnimationFrame","time","action","setTimeout","duration","performance","now","console","log","apply","args","object","keys","copy","options","response","error","fetchOptions","Object","filter","key","indexOf","forEach","fetch","url","then","ok","catch","event","document","onkeydown","keyEvent","onkeyup","randomValue","Math","random","max","min","debounceTimeouts","clearTimeout","wait","throttleLocks","rate","isFx","Array","isArray","isFn","value","runIfFx","actions","currentEvent","maybeFx","length","getNextAction","partialActions","paths","nextAction","Error","slice","split","bind","type","fxRunner","handleEventFx","currentFx","makeEnhancedView","view","state","vdom","patchVdomFx","attributes","children","makeFxApp","nextApp","initialState","actionsTemplate","container","enhancedActions","enhanceActions","reduce","otherActions","enhancedView","withFx","fxOrApp","fxIf","fxSpecs","fxSpec","map","frame","delay","arguments","http","keydown","keyup","debounce","throttle"],"mappings":"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","sourcesContent":["(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.hyperappFx = {})));\n}(this, (function (exports) { 'use strict';\n\n  function assign(source, assignments) {\n    var result = {},\n      i;\n    for (i in source) result[i] = source[i];\n    for (i in assignments) result[i] = assignments[i];\n    return result\n  }\n\n  function omit(object, keys) {\n    var copy = {};\n    Object.keys(object)\n      .filter(function(key) {\n        return keys.indexOf(key) === -1\n      })\n      .forEach(function(key) {\n        copy[key] = object[key];\n      });\n    return copy\n  }\n\n  var ACTION = \"action\";\n  var FRAME = \"frame\";\n  var DELAY = \"delay\";\n  var TIME = \"time\";\n  var LOG = \"log\";\n  var HTTP = \"http\";\n  var EVENT = \"event\";\n  var KEY_DOWN = \"keydown\";\n  var KEY_UP = \"keyup\";\n  var RANDOM = \"random\";\n  var DEBOUNCE = \"debounce\";\n  var THROTTLE = \"throttle\";\n\n  function makeDefaultFx() {\n    var fx = {};\n\n    fx[ACTION] = function(props, getAction) {\n      getAction(props.name)(props.data);\n    };\n\n    fx[FRAME] = function(props, getAction) {\n      requestAnimationFrame(function(time) {\n        getAction(props.action)(time);\n      });\n    };\n\n    fx[DELAY] = function(props, getAction) {\n      setTimeout(function() {\n        getAction(props.action)(props.data);\n      }, props.duration);\n    };\n\n    fx[TIME] = function(props, getAction) {\n      getAction(props.action)(performance.now());\n    };\n\n    fx[LOG] = function(props) {\n      // eslint-disable-next-line no-console\n      console.log.apply(null, props.args);\n    };\n\n    fx[HTTP] = function(props, getAction) {\n      var options = assign(\n        {\n          response: \"json\",\n          error: props.action\n        },\n        props.options\n      );\n      var fetchOptions = omit(options, [\"response\", \"error\"]);\n      fetch(props.url, fetchOptions)\n        .then(function(response) {\n          if (!response.ok) {\n            throw response\n          }\n          return response\n        })\n        .then(function(response) {\n          return response[options.response]()\n        })\n        .then(function(result) {\n          getAction(props.action)(result);\n        })\n        .catch(function(error) {\n          getAction(options.error)(error);\n        });\n    };\n\n    fx[EVENT] = function(props, getAction) {\n      getAction(props.action)(props.event);\n    };\n\n    fx[KEY_DOWN] = function(props, getAction) {\n      document.onkeydown = function(keyEvent) {\n        getAction(props.action)(keyEvent);\n      };\n    };\n\n    fx[KEY_UP] = function(props, getAction) {\n      document.onkeyup = function(keyEvent) {\n        getAction(props.action)(keyEvent);\n      };\n    };\n\n    fx[RANDOM] = function(props, getAction) {\n      var randomValue = Math.random() * (props.max - props.min) + props.min;\n      getAction(props.action)(randomValue);\n    };\n\n    var debounceTimeouts = {};\n    fx[DEBOUNCE] = function(props, getAction) {\n      return (function(props, getAction) {\n        clearTimeout(debounceTimeouts[props.action]);\n        debounceTimeouts[props.action] = setTimeout(function() {\n          getAction(props.action)(props.data);\n        }, props.wait);\n      })(props, getAction)\n    };\n\n    var throttleLocks = {};\n    fx[THROTTLE] = function(props, getAction) {\n      return (function(props, getAction) {\n        if (!throttleLocks[props.action]) {\n          getAction(props.action)(props.data);\n          throttleLocks[props.action] = true;\n          setTimeout(function() {\n            throttleLocks[props.action] = false;\n          }, props.rate);\n        }\n      })(props, getAction)\n    };\n\n    return fx\n  }\n\n  var isFx = Array.isArray;\n  var isFn = function(value) {\n    return typeof value === \"function\"\n  };\n\n  function getActionNamed(actions, name) {\n    function getNextAction(partialActions, paths) {\n      var nextAction = partialActions[paths[0]];\n      if (!nextAction) {\n        throw new Error(\"couldn't find action: \" + name)\n      }\n      return paths.length === 1\n        ? nextAction\n        : getNextAction(nextAction, paths.slice(1))\n    }\n    return getNextAction(actions, name.split(\".\"))\n  }\n\n  function runIfFx(actions, currentEvent, maybeFx, fx) {\n    if (!isFx(maybeFx)) {\n      // Not an effect\n      return maybeFx\n    } else if (isFx(maybeFx[0])) {\n      // Run an array of effects\n      for (var i in maybeFx) {\n        runIfFx(actions, currentEvent, maybeFx[i], fx);\n      }\n    } else if (maybeFx.length) {\n      // Run a single effect\n      var getAction = getActionNamed.bind(null, actions);\n      var type = maybeFx[0];\n      var props = assign(maybeFx[1], { event: currentEvent });\n      var fxRunner = fx[type];\n      if (isFn(fxRunner)) {\n        fxRunner(props, getAction);\n      } else {\n        throw new Error(\"no such fx type: \" + type)\n      }\n    }\n  }\n\n  function enhanceActions(actionsTemplate, fx) {\n    return Object.keys(actionsTemplate || {}).reduce(function(\n      otherActions,\n      name\n    ) {\n      var action = actionsTemplate[name];\n      otherActions[name] = isFn(action)\n        ? function(data) {\n            return function(state, actions) {\n              var result = action(data);\n              result = isFn(result) ? result(state, actions) : result;\n              return runIfFx(actions, null, result, fx)\n            }\n          }\n        : enhanceActions(action, fx);\n      return otherActions\n    },\n    {})\n  }\n\n  function handleEventFx(actions, currentFx, fx) {\n    return function(currentEvent) {\n      runIfFx(actions, currentEvent, currentFx, fx);\n    }\n  }\n\n  function makeEnhancedView(view, fx) {\n    function patchVdomFx(actions, vdom) {\n      if (typeof vdom === \"object\") {\n        for (var key in vdom.attributes) {\n          var maybeFx = vdom.attributes[key];\n          if (isFx(maybeFx)) {\n            vdom.attributes[key] = handleEventFx(actions, maybeFx, fx);\n          }\n        }\n        for (var i in vdom.children) {\n          if (isFn(vdom.children[i])) {\n            vdom.children[i] = makeEnhancedView(vdom.children[i], fx);\n          } else {\n            patchVdomFx(actions, vdom.children[i], fx);\n          }\n        }\n      }\n    }\n    return function(state, actions) {\n      var vdom = view(state, actions);\n      patchVdomFx(actions, vdom, fx);\n      return vdom\n    }\n  }\n\n  function makeFxApp(fx, nextApp) {\n    return function(initialState, actionsTemplate, view, container) {\n      var enhancedActions = enhanceActions(actionsTemplate, fx);\n      var enhancedView = makeEnhancedView(view, fx);\n\n      var appActions = nextApp(\n        initialState,\n        enhancedActions,\n        enhancedView,\n        container\n      );\n      return appActions\n    }\n  }\n\n  function withFx(fxOrApp) {\n    var fx = makeDefaultFx();\n    if (typeof fxOrApp === \"function\") {\n      return makeFxApp(fx, fxOrApp)\n    } else {\n      for (var name in fxOrApp) {\n        fx[name] = fxOrApp[name];\n      }\n      return function(nextApp) {\n        return makeFxApp(fx, nextApp)\n      }\n    }\n  }\n\n  function action(name, data) {\n    return [\n      ACTION,\n      {\n        name: name,\n        data: data\n      }\n    ]\n  }\n\n  function frame(action) {\n    return [\n      FRAME,\n      {\n        action: action\n      }\n    ]\n  }\n\n  function delay(duration, action, data) {\n    return [\n      DELAY,\n      {\n        duration: duration,\n        action: action,\n        data: data\n      }\n    ]\n  }\n\n  function time(action) {\n    return [\n      TIME,\n      {\n        action: action\n      }\n    ]\n  }\n\n  function log() {\n    return [\n      LOG,\n      {\n        args: arguments\n      }\n    ]\n  }\n\n  function http(url, action, options) {\n    return [\n      HTTP,\n      {\n        url: url,\n        action: action,\n        options: options\n      }\n    ]\n  }\n\n  function event(action) {\n    return [\n      EVENT,\n      {\n        action: action\n      }\n    ]\n  }\n\n  function keydown(action) {\n    return [\n      KEY_DOWN,\n      {\n        action: action\n      }\n    ]\n  }\n\n  function keyup(action) {\n    return [\n      KEY_UP,\n      {\n        action: action\n      }\n    ]\n  }\n\n  function random(action, min, max) {\n    return [\n      RANDOM,\n      {\n        action: action,\n        min: min || 0,\n        max: max || 1\n      }\n    ]\n  }\n\n  function debounce(wait, action, data) {\n    return [\n      DEBOUNCE,\n      {\n        wait: wait,\n        action: action,\n        data: data\n      }\n    ]\n  }\n\n  function throttle(rate, action, data) {\n    return [\n      THROTTLE,\n      {\n        rate: rate,\n        action: action,\n        data: data\n      }\n    ]\n  }\n\n  function fxIf(fxSpecs) {\n    return fxSpecs\n      .filter(function(fxSpec) {\n        // first element is the conditional\n        return fxSpec[0]\n      })\n      .map(function(fxSpec) {\n        // second element is the effect to include\n        return fxSpec[1]\n      })\n  }\n\n  exports.withFx = withFx;\n  exports.fxIf = fxIf;\n  exports.action = action;\n  exports.frame = frame;\n  exports.delay = delay;\n  exports.time = time;\n  exports.log = log;\n  exports.http = http;\n  exports.event = event;\n  exports.keydown = keydown;\n  exports.keyup = keyup;\n  exports.random = random;\n  exports.debounce = debounce;\n  exports.throttle = throttle;\n\n  Object.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=hyperappFx.js.map\n"]}